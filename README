# Restaurant Backend API ğŸ”

Una API RESTful robusta y moderna para la gestiÃ³n de un restaurante, construida con Node.js, Express y MongoDB. Este proyecto demuestra las mejores prÃ¡cticas en el desarrollo de backend, incluyendo la gestiÃ³n de conexiones a bases de datos, la creaciÃ³n de endpoints complejos y la implementaciÃ³n de un suite de pruebas automatizadas.

## ğŸš€ CaracterÃ­sticas

-   **GestiÃ³n de Usuarios**: Endpoints completos para crear, leer, actualizar y eliminar (CRUD) usuarios.
-   **GestiÃ³n de Ã“rdenes**: Un sistema completo para gestionar las Ã³rdenes del restaurante.
    -   Soporte para diferentes tipos de pedido: `mesa`, `domicilio`, `recoger`.
    -   Estructura de productos detallada, permitiendo cantidades y estados individuales por unidad (ej. 2 hamburguesas, una en preparaciÃ³n y otra lista).
    -   Propiedades como nÃºmero de mesa, cantidad de personas, ID de cliente (para domicilios), total, etc.
-   **Base de Datos en la Nube**: IntegraciÃ³n con MongoDB Atlas para un almacenamiento de datos escalable y seguro.
-   **Testing Automatizado**: Suite de pruebas completo usando Jest y Supertest para asegurar la fiabilidad de la API.
-   **CÃ³digo Moderno**: Escrito con la sintaxis de MÃ³dulos de ES (`import`/`export`) y siguiendo las mejores prÃ¡cticas de estructura de proyectos.
-   **Variables de Entorno**: ConfiguraciÃ³n segura de credenciales y datos sensibles usando `dotenv`.

## ğŸ› ï¸ Stack TecnolÃ³gico

-   **Lenguaje**: JavaScript (ESM)
-   **Backend**: Node.js
-   **Framework**: Express.js
-   **Base de Datos**: MongoDB (con el driver nativo)
-   **Testing**: Jest, Supertest
-   **TranspilaciÃ³n**: Babel
-   **ConfiguraciÃ³n**: dotenv

## ğŸ“‹ Prerrequisitos

-   [Node.js](https://nodejs.org/) instalado (versiÃ³n 18 o superior).
-   [npm](https://www.npmjs.com/) (normalmente viene con Node.js).
-   Una cuenta en [MongoDB Atlas](https://www.mongodb.com/cloud/atlas) y un cluster configurado.

## âš™ï¸ InstalaciÃ³n y ConfiguraciÃ³n

Sigue estos pasos para poner en marcha el proyecto en tu mÃ¡quina local.

1.  **Clona el repositorio**
    ```bash
    git clone https://github.com/tu-usuario/restaurant-backend.git
    cd restaurant-backend
    ```

2.  **Instala las dependencias**
    ```bash
    npm install
    ```

3.  **Configura las variables de entorno**
    -   Crea un archivo llamado `.env` en la raÃ­z del proyecto.
    -   AÃ±ade tus credenciales de MongoDB Atlas. **Importante**: AsegÃºrate de especificar el nombre de tu base de datos al final de la URI.

    ```env
    # .env

    # Reemplaza los valores con los de tu cluster de MongoDB Atlas
    MONGODB_URI=mongodb+srv://<usuario>:<password>@<cluster-url>/<nombre_de_tu_db>?retryWrites=true&w=majority&appName=Cluster0
    
    # Puerto en el que correrÃ¡ el servidor
    PORT=3000
    ```
    **Nota**: El `<nombre_de_tu_db>` es crucial. Si no lo especificas, se usarÃ¡ una base de datos llamada `test`.

4.  **Prepara la base de datos**
    -   Ve a tu cluster en MongoDB Atlas.
    -   Navega a "Browse Collections" y crea la base de datos que especificaste en el paso anterior (ej. `restaurant_db`).
    -   Dentro de esa base de datos, puedes crear las colecciones `usuarios` y `ordenes` o dejar que la aplicaciÃ³n las cree automÃ¡ticamente al usarlas.

## ğŸƒâ€â™‚ï¸ CÃ³mo Ejecutar la AplicaciÃ³n

### Iniciar el Servidor

Para iniciar el servidor en modo de desarrollo:

```bash
node index.js
```

DeberÃ­as ver en la consola:
```
âœ… Conectado exitosamente a MongoDB Atlas!
Servidor escuchando en http://localhost:3000
```

### Ejecutar las Pruebas

Para ejecutar el suite de pruebas automatizadas:

```bash
npm test
```

Esto ejecutarÃ¡ todas las pruebas para los endpoints de usuarios y Ã³rdenes, asegurando que todo funciona como se espera.

## ğŸ“¡ Uso de la API (Endpoints)

A continuaciÃ³n se detallan todos los endpoints disponibles y cÃ³mo probarlos usando `curl`.

### Usuarios

| MÃ©todo | Endpoint | DescripciÃ³n |
|---|---|---|
| `POST` | `/api/usuarios` | Crea un nuevo usuario. |
| `GET` | `/api/usuarios` | Obtiene la lista de todos los usuarios. |
| `GET` | `/api/usuarios/:id` | Obtiene un usuario especÃ­fico por su ID. |
| `PUT` | `/api/usuarios/:id` | Actualiza un usuario existente. |
| `DELETE` | `/api/usuarios/:id` | Elimina un usuario existente. |

**Ejemplo: Crear un nuevo usuario**
```bash
curl -X POST http://localhost:3000/api/usuarios \
-H "Content-Type: application/json" \
-d '{"nombre": "Carlos", "edad": 30, "ciudad": "BogotÃ¡"}'
```

### Ã“rdenes

| MÃ©todo | Endpoint | DescripciÃ³n |
|---|---|---|
| `POST` | `/api/ordenes` | Crea una nueva orden. |
| `GET` | `/api/ordenes` | Obtiene la lista de todas las Ã³rdenes. |
| `GET` | `/api/ordenes/:id` | Obtiene una orden especÃ­fica por su ID. |
| `PUT` | `/api/ordenes/:id` | Actualiza una orden existente. |

**Ejemplo 1: Crear una orden para mesa**
```bash
curl -X POST http://localhost:3000/api/ordenes \
-H "Content-Type: application/json" \
-d '{
  "mesa": 8,
  "cantidadPersonas": 3,
  "tipoPedido": "mesa",
  "productosSolicitados": [
    {
      "nombreProducto": "Hamburguesa Especial",
      "cantidadSolicitada": 2,
      "mensaje": "Una sin tomate.",
      "estadosPorCantidad": [
        { "estado": "recibida" },
        { "estado": "recibida" }
      ]
    }
  ],
  "cantidadIps": 2,
  "total": 55000
}'
```

**Ejemplo 2: Actualizar el estado de una orden**
(Usa el `orderId` devuelto al crear la orden)
```bash
curl -X PUT http://localhost:3000/api/ordenes/<ID_DE_LA_ORDEN> \
-H "Content-Type: application/json" \
-d '{
  "mesa": 8,
  "cantidadPersonas": 3,
  "tipoPedido": "mesa",
  "productosSolicitados": [
    {
      "nombreProducto": "Hamburguesa Especial",
      "cantidadSolicitada": 2,
      "mensaje": "Una sin tomate.",
      "estadosPorCantidad": [
        { "estado": "cocinando" },
        { "estado": "listo_para_servir" }
      ]
    }
  ],
  "cantidadIps": 2,
  "total": 55000
}'
```

## ğŸ“ Estructura del Proyecto

```
restaurant-backend/
â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â”œâ”€â”€ babel.config.cjs
â”œâ”€â”€ jest.config.js
â”œâ”€â”€ jest.setup.js
â”œâ”€â”€ package.json
â”œâ”€â”€ index.js
â””â”€â”€ src/
    â”œâ”€â”€ app.js
    â”œâ”€â”€ config/
    â”‚   â””â”€â”€ db.js
    â””â”€â”€ routes/
        â”œâ”€â”€ usuario.routes.js
        â””â”€â”€ ordenes.routes.js
```

## ğŸ§  Nuestro Viaje de Aprendizaje

Este proyecto no es solo cÃ³digo, es el resultado de un proceso de aprendizaje y depuraciÃ³n. Desde la configuraciÃ³n inicial del proyecto y la conexiÃ³n a la base de datos, hasta la implementaciÃ³n de un sistema de testing robusto y la resoluciÃ³n de errores sutiles (como las condiciones de carrera en las pruebas y los bugs en los endpoints `PUT`), cada paso fue una oportunidad para mejorar y entender mejor cÃ³mo construir aplicaciones del mundo real.

---

**Â¡Disfruta explorando la API!** Si tienes alguna sugerencia o encuentras un error, no dudes en abrir un issue o enviar un pull request.